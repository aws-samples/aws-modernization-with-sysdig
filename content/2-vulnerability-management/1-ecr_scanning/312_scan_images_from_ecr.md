---
title: "Scan images from ECR"
chapter: false
weight: 32
---

### Download Example Dockerfile and Sources

Now that our automated scanner is in place, it will trigger full registry scans periodically. 

Lets trigger a manual scan (we don't want to wait until the cron job triggers next scan action). Launch a job instance using kubectl.

```
kubectl create job --from=cronjob/registry-scanner registry-scanner-manual
```

The job should create a pod in the default namespace to retrieve the list of images and scan them one by one. Logs from the pod can be checked to see if everything went fine.

```
kubectl get po  
```

Take note of pod name, it should be something like <i>registry-scanner-manual-\<random-string\></i>. This generated pod will also create a second pod (worker pod) if it detects images matching scan requirements like creation date, etc.

```
NAME                                    READY   STATUS      RESTARTS   AGE
registry-scanner-manual-lncqq           1/1     Running     0          13s
registry-scanner-worker-tt5ck-1-hts85   0/1     Completed   0          11s
```

Retrieve pod logs with kubectl.

```
kubectl logs registry-scanner-manual-lncqq   
```

Logs should clarify if the scan action where successful. All images within the ECR repository should have been scanned.

```
...
...
{"level":"info","component":"report-builder","time":"2023-04-25T09:55:23Z","message":"Registry image scan has finished. Total: 1 = Success: 1 + Failed: 0 + Skipped: 0"}
```
    
### See Scan Results on Sysdig Secure Dashboard

To see the scan results on Sysdig Secure Dashboard,

1. Log into the Sysdig Secure UI, and browse to [**Vulnerabilities > Registry**](https://app.au1.sysdig.com/secure/#/vulnerabilities/registry/):

	![Sysdig Secure](/images/30_module_1/Sysdig_Secure02.png)

2. Click your new `aws-workshop` image.

	You'll see the image have several major vulnerabilities.

	![Sysdig Secure](/images/30_module_1/securescann02.png)

With Sysdig Secure you have full visibility of the security and compliance posture across your entire estate, in a single pane of glass, and as a central location for all security profiles and policies.

<!-- #### Optional: Further Information

You can see a complete log of the scan process by clicking [ECS Scan log](https://gist.githubusercontent.com/johnfitzpatrick/369c1f9df765be68ba2d83cbe37f6eb3/raw/421fe8d829ad74cd406d09ca6625283e4020751b/gistfile1.txt).  This shows

<! - - https://gist.github.com/johnfitzpatrick/369c1f9df765be68ba2d83cbe37f6eb3 - - >

1. layers of the image getting pulled and flattened (lines 24-199)

2. analysis phase, the metadata getting sent to (lines 201-204)

3. metadata getting posted to Sysdig Backend (line 206)

	- backend analyses the metadata between lines 206 & 207

4. results of the scan are returned from the Sysdig Backend (lines 207-1979)

5. inline scanner script returns exit code 1 (line 1985) -->


