---
title: "Setup Amazon ECR Registry"
chapter: false
weight: 31
---

For the purposes of this lab you need to create an Amazon ECR registry. To do this, follow the steps below

1. Log into your Cloud9 Workspace

2. Run the following command to create a repository. The name is arbitrary, but for continuity in the lab please use 'aws-workshop':

    ```
    export ECR_NAME=aws-workshop
    export REGION=us-east-1

    aws ecr create-repository --repository-name $ECR_NAME \
      --image-scanning-configuration scanOnPush=true \
      --region $REGION
    ```

    The output will be as follows:

    ```
    {
        "repository": {
            "repositoryArn": "arn:aws:ecr:us-east-1:606901652329:repository/aws-workshop",
            "registryId": "606901652329",
            "repositoryName": "aws-workshop",
            "repositoryUri": "606901652329.dkr.ecr.us-east-1.amazonaws.com/aws-workshop",
            "createdAt": "2022-12-15T15:25:12+00:00",
            "imageTagMutability": "MUTABLE",
            "imageScanningConfiguration": {
                "scanOnPush": true
            },
            "encryptionConfiguration": {
                "encryptionType": "AES256"
            }
        }
    }
    ```

3. You can view the repository in [Amazon UI](https://us-east-1.console.aws.amazon.com/ecr/repositories?region=us-east-1):

    ![ECR](/images/30_module_1/Amazon_ECR01_1.png)

### Authenticate AWS CLI With Amazon ECR registry

Shortly you will use your Cloud9 Workspace to create and push a docker container to your new ECR Repository, however, before doing so you must configure docker's access to the repository.

1. Log into your Cloud9 workspace

2. Authenticate the Docker command line tool to this Amazon ECR registry, using AWS CLI tool as follows

    ```
    export AWS_ACCOUNT=$(aws sts get-caller-identity | jq '.Account' | xargs)
    echo "$ECR_NAME, $REGION, $AWS_ACCOUNT"
    aws ecr get-login-password --region $REGION | \
      docker login --username AWS --password-stdin \
      $AWS_ACCOUNT.dkr.ecr.$REGION.amazonaws.com
    ```

    The output should look similar to the following

    ```
    WARNING! Your password will be stored unencrypted in /home/ec2-user/.docker/config.json.
    Configure a credential helper to remove this warning. See
    https://docs.docker.com/engine/reference/commandline/login/#credentials-store

    Login Succeeded
    ```

Now you can use the Amazon ECR Registry from your CLI.

{{% notice note %}}
For more details on this procedure, please refer to [Amazon ECR registries - Amazon ECR](https://docs.aws.amazon.com/AmazonECR/latest/userguide/Registries.html)
{{% /notice %}}
