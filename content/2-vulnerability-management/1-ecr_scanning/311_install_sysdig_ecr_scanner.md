---
title: "Install Sysdig Automated ECR Scanner"
chapter: false
weight: 31
---

### Create the target registry

We need to create the ECR registry that we want to secure.

1. Go to your Cloud9 Workspace and download and uncompress example container files:
    <!-- wget https://github.com/sysdiglabs/hello-world-node-vulnerable/releases/download/v1.0/hello-world-node-vulnerable.zip -->
    ```
    wget https://github.com/johnfitzpatrick/hello-world-node-vulnerable/archive/v1.2.zip
    unzip v1.2.zip
    cd hello-world-node-vulnerable-1.2 
    ```

2. To illustrate the images scanning we will build an example Node.JS application based on the official “hello world” example described in [their website](https://nodejs.org/de/docs/guides/nodejs-docker-webapp/).
    build and push the image to ECR
    ```
    AWS_ACCOUNT=$(aws sts get-caller-identity | jq '.Account' | xargs)
    export ECR_NAME=aws-workshop
    export REGION=us-east-1
    export IMAGE=$AWS_ACCOUNT.dkr.ecr.$REGION.amazonaws.com/$ECR_NAME
    docker build . -t $IMAGE
    docker push $IMAGE 
    ```

3. Access to the registry via AWS Console UI (Amazon ECR > Repositories). The new registry "aws-workshop" should be listed. Copy its URI from the list.

### Using Kubectl to onboard the ECR scanner

Sysdig Automated Registry Scanner is delivered as a Kubernetes CronJob. It requires a Kubernetes cluster to be hosted. Once installed it will trigger a full registry scan on a regular basis (once a week by default).

Install the Scanner Cron-Job via helm chart on the EKS cluster. (Please make sure that the EKS cluster has been created and Kubectl configured as indicated in the prerequisites section).

    helm upgrade --install registry-scanner \
        --version=1.0.4 \
        --set config.secureBaseURL=<YOUR-SYSDIG-REGION> \
        --set config.secureAPIToken=<YOUR-SYSDIG-TOKEN> \
        --set config.registryURL=<ECR-REGISTRY-URI> \
        --set config.registryType=ecr \
        --set config.registryUser="" \
        --set config.registryPassword="" \
        --set config.filter.maxAgeDays=999 \
        sysdig/registry-scanner

Check that the cron-job was properly installed.

    kubectl get cronjobs

Output should looks like this example

    NAME               SCHEDULE    SUSPEND   ACTIVE   LAST SCHEDULE   AGE
    registry-scanner   0 6 * * 6   False     0        <none>          2d1h

In the next section we will find out how to trigger a scan action manually.



